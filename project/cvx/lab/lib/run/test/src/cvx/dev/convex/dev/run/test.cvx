(sreq/dep {T     "project/cvx/lab/lib/run/test/src/cvx/main/convex/run/test.cvx"
           xform "project/cvx/lab/lib/xform/src/cvx/main/convex/xform.cvx"})



(sreq/hook.error (fn [ex]
                   (sreq/out (dissoc ex
                                     :trace))))

(eval (first xform))
(eval `(def T
            (deploy (quote ~(cons 'do
                                  (next (next T)))))))


(import convex.xform :as xform)


(sreq/screen.clear)





(T/filter.set :important?)


(T/meta.set (fn [x] (assoc x :important? true)))


(T/state.push)





(T/trx '(do
          (def baz 24)
          (< 2 5)))


(def x
     42)


(T/trx '(T/is (< x 4)))

(let [a 4
      b 3]
  (T/trx `(or (< ~a ~b)
                 (- ~a ~b))
            {:description "I know, it fails."}))

(def foo 42)

(T/state.pop `(def bar ~foo))


(T/fail-code #{:ASSERT}
             '(T/is (= 1
                       2))
             {:description "Must fail fast."})

;(sreq/hook.end '[(T/exit)])


(sreq/out \newline)


(sreq/out help/single-run?)

;(T/print-failed)

(T/exit)




#_(sreq/do '[(sreq/out \newline):
           (sreq/log)
           (sreq/out [:log help/*trx.last.result*])])
